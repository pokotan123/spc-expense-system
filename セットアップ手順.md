# SPC 経費精算システム セットアップ手順

## 1. プロジェクトの初期化完了

プロジェクトの基本構造が作成されました。

## 2. 次のステップ

### ステップ1: 依存関係のインストール

#### フロントエンド
```bash
cd apps/frontend
npm install
```

#### バックエンド
```bash
cd apps/backend
npm install
```

### ステップ2: 環境変数の設定

#### フロントエンド
```bash
cd apps/frontend
cp .env.example .env.local
# .env.localを編集
```

#### バックエンド
```bash
cd apps/backend
cp .env.example .env
# .envを編集
```

### ステップ3: データベースのセットアップ

#### Prismaクライアントの生成
```bash
cd apps/backend
npm run generate
```

#### データベースマイグレーション（ローカル開発用）
```bash
cd apps/backend
npm run migrate:dev
```

### ステップ4: 開発サーバーの起動

#### フロントエンド
```bash
cd apps/frontend
npm run dev
# http://localhost:3001 でアクセス
```

#### バックエンド
```bash
cd apps/backend
npm run dev
# http://localhost:3000 でアクセス
```

## 3. GitHubへのアップロード

### ステップ1: GitHubリポジトリを作成

1. GitHubにログイン
2. "New repository"をクリック
3. リポジトリ名: `spc-expense-system`
4. 説明を入力
5. PublicまたはPrivateを選択
6. "Create repository"をクリック

### ステップ2: リモートリポジトリを追加

```bash
cd /Users/yukio/Downloads/SPCさん/spc-expense-system
git remote add origin https://github.com/your-username/spc-expense-system.git
```

### ステップ3: 初回コミット

```bash
git add .
git commit -m "Initial commit: Project setup"
git branch -M main
git push -u origin main
```

## 4. Vercelへのデプロイ（フロントエンド）

### ステップ1: Vercelプロジェクトを作成

1. [Vercel](https://vercel.com)にログイン
2. "New Project"をクリック
3. GitHubリポジトリを選択: `spc-expense-system`
4. プロジェクト設定:
   - **Framework Preset**: Next.js
   - **Root Directory**: `apps/frontend`
   - **Build Command**: `npm run build`（自動検出）
   - **Output Directory**: `.next`（自動検出）
5. 環境変数を設定:
   - `NEXT_PUBLIC_API_URL`: バックエンドのURL（後で設定）
   - `NEXT_PUBLIC_APP_URL`: VercelのURL
6. "Deploy"をクリック

## 5. Railwayへのデプロイ（バックエンド・データベース）

### ステップ1: PostgreSQLデータベースを作成

1. [Railway](https://railway.app)にログイン
2. "New Project"をクリック
3. "Database" → "Add PostgreSQL"を選択
4. データベースが自動作成される
5. 接続情報を確認（後で環境変数に設定）

### ステップ2: バックエンドサービスを作成

1. Railwayプロジェクトで"New" → "GitHub Repo"を選択
2. リポジトリ: `spc-expense-system`を選択
3. 設定:
   - **Root Directory**: `apps/backend`
   - **Build Command**: `npm install && npm run build && npm run generate`
   - **Start Command**: `npm start`
4. 環境変数を設定:
   - `DATABASE_URL`: PostgreSQLの接続URL（Railwayが自動設定）
   - `NODE_ENV`: `production`
   - `PORT`: `3000`（Railwayが自動設定）
   - `JWT_SECRET`: ランダムな文字列を生成
   - `CORS_ORIGIN`: VercelのフロントエンドURL
   - その他の環境変数（OCR、S3、SPC会員DB連携など）
5. デプロイが自動実行される

### ステップ3: データベースマイグレーション

Railwayのバックエンドサービスで以下を実行:

```bash
npm run migrate
```

または、RailwayのCLIを使用:

```bash
railway run npm run migrate
```

## 6. 環境変数の最終設定

### Vercel（フロントエンド）

Vercelダッシュボードで以下を更新:

```
NEXT_PUBLIC_API_URL=https://your-backend.railway.app/api/v1
```

### Railway（バックエンド）

Railwayダッシュボードで以下を確認・設定:

- `DATABASE_URL`: 自動設定済み
- `CORS_ORIGIN`: VercelのフロントエンドURLを設定

## 7. 動作確認

1. フロントエンドにアクセス: VercelのURL
2. バックエンドのヘルスチェック: `https://your-backend.railway.app/health`
3. API動作確認: `https://your-backend.railway.app/api/v1/health`

## 8. トラブルシューティング

### データベース接続エラー

- `DATABASE_URL`環境変数を確認
- RailwayのPostgreSQL接続情報を確認
- マイグレーションが実行されているか確認

### CORSエラー

- バックエンドの`CORS_ORIGIN`環境変数を確認
- VercelのフロントエンドURLが正しく設定されているか確認

### ビルドエラー

- ログを確認
- 環境変数が正しく設定されているか確認
- 依存関係が正しくインストールされているか確認

## 9. 参考資料

- [デプロイ手順書](./docs/デプロイ手順書.md)
- [技術スタック定義](./docs/技術スタック定義.md)
- [API仕様書](./docs/api-specification.yaml)
