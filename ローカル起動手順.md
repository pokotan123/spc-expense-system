# ローカル起動手順

## 📋 前提条件

- Node.js 20以上がインストールされていること
- npmがインストールされていること
- PostgreSQLがインストールされていること（オプション、モックデータで動作可能）

## 🚀 クイックスタート

### 1. バックエンドの起動

```bash
cd apps/backend

# 依存関係のインストール
npm install

# 環境変数の設定（.envファイルを作成）
# DATABASE_URLが設定されていない場合はモックデータで動作します

# 開発サーバー起動
npm run dev
```

バックエンドは `http://localhost:3001` で起動します。

### 2. フロントエンドの起動（別ターミナル）

```bash
cd apps/frontend

# 依存関係のインストール
npm install

# 開発サーバー起動
npm run dev
```

フロントエンドは `http://localhost:3000` で起動します。

## ⚙️ 環境変数の設定

### バックエンド（apps/backend/.env）

```env
# アプリケーション設定
NODE_ENV=development
PORT=3001
API_VERSION=v1

# データベース（オプション、未設定でもモックデータで動作）
DATABASE_URL=postgresql://user:password@localhost:5432/spc_expense?schema=public

# JWT認証
JWT_SECRET=development-secret-key-change-in-production
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d

# CORS
CORS_ORIGIN=http://localhost:3000
```

### フロントエンド（apps/frontend/.env.local）

```env
NEXT_PUBLIC_API_URL=http://localhost:3001/api/v1
```

## 🔧 データベースを使用する場合

### 1. PostgreSQLの起動

```bash
# macOS (Homebrew)
brew services start postgresql@14

# Linux
sudo systemctl start postgresql
```

### 2. データベースの作成

```bash
psql -U postgres
CREATE DATABASE spc_expense;
\q
```

### 3. マイグレーションの実行

```bash
cd apps/backend
npm run generate
npm run migrate:dev
npm run seed
```

## 🧪 動作確認

### 1. バックエンドの確認

```bash
# ヘルスチェック
curl http://localhost:3001/health
```

### 2. フロントエンドの確認

ブラウザで `http://localhost:3000` にアクセス

### 3. ログイン

- **会員**: `member001` / `password`
- **事務局**: `admin001` / `password`

## 🐛 トラブルシューティング

### ポートが使用中

**エラー**: `Error: listen EADDRINUSE: address already in use :::3001`

**解決方法**:
```bash
# ポート3001を使用しているプロセスを確認
lsof -ti:3001

# プロセスを終了
kill -9 $(lsof -ti:3001)
```

### データベース接続エラー

**エラー**: `Can't reach database server`

**解決方法**:
- `.env`ファイルの`DATABASE_URL`を確認
- PostgreSQLが起動しているか確認
- データベースが作成されているか確認
- **注意**: データベースが未設定でもモックデータで動作します

### モジュールが見つからない

**エラー**: `Cannot find module`

**解決方法**:
```bash
# 依存関係を再インストール
cd apps/backend
rm -rf node_modules package-lock.json
npm install

cd ../frontend
rm -rf node_modules package-lock.json
npm install
```

## 📝 注意事項

- データベースが未設定でも、モックデータで動作します
- 初回起動時は依存関係のインストールに時間がかかることがあります
- フロントエンドとバックエンドは別々のターミナルで起動してください
