# SPC 経費精算システム プロジェクト構成案

## 1. リポジトリ構成

### オプションA: モノリポ構成（推奨）

単一リポジトリでフロントエンドとバックエンドを管理。

```
spc-expense-system/
├── apps/
│   ├── frontend/              # Next.js フロントエンド
│   │   ├── .env.example
│   │   ├── .gitignore
│   │   ├── next.config.js
│   │   ├── package.json
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── components/
│   │   │   ├── lib/
│   │   │   └── types/
│   │   └── public/
│   │
│   └── backend/               # Express バックエンド
│       ├── .env.example
│       ├── .gitignore
│       ├── Dockerfile
│       ├── package.json
│       ├── railway.json
│       ├── src/
│       │   ├── controllers/
│       │   ├── models/
│       │   ├── routes/
│       │   ├── services/
│       │   ├── middleware/
│       │   └── utils/
│       └── prisma/            # Prismaスキーマ
│           └── schema.prisma
│
├── docs/                      # ドキュメント
│   ├── api-specification.yaml
│   ├── database-schema.md
│   ├── database-schema.mmd
│   ├── MVP要件定義.md
│   ├── 技術スタック定義.md
│   ├── デプロイ手順書.md
│   └── ...
│
├── .github/
│   └── workflows/
│       └── deploy.yml          # CI/CD設定（オプション）
│
├── .gitignore
└── README.md
```

**メリット**:
- 単一リポジトリで管理が簡単
- コード共有が容易
- バージョン管理が統一

### オプションB: マルチリポジトリ構成

フロントエンドとバックエンドを別リポジトリで管理。

```
spc-expense-system-frontend/   # フロントエンドリポジトリ
spc-expense-system-backend/     # バックエンドリポジトリ
```

**メリット**:
- 独立したデプロイ
- チーム分離が容易

---

## 2. フロントエンド構成（Next.js）

### 2.1 ディレクトリ構造

```
frontend/
├── src/
│   ├── app/                   # App Router
│   │   ├── (auth)/
│   │   │   └── login/
│   │   ├── (member)/
│   │   │   ├── dashboard/
│   │   │   ├── applications/
│   │   │   └── applications/[id]/
│   │   ├── (admin)/
│   │   │   ├── applications/
│   │   │   └── payments/
│   │   ├── api/                # API Routes（必要に応じて）
│   │   ├── layout.tsx
│   │   └── page.tsx
│   │
│   ├── components/            # UIコンポーネント
│   │   ├── ui/                 # shadcn/uiコンポーネント
│   │   ├── forms/
│   │   ├── layouts/
│   │   └── common/
│   │
│   ├── lib/                   # ユーティリティ
│   │   ├── api/               # APIクライアント
│   │   ├── auth/              # 認証関連
│   │   ├── utils/
│   │   └── constants/
│   │
│   ├── hooks/                  # カスタムフック
│   ├── types/                  # TypeScript型定義
│   └── stores/                 # 状態管理（Zustand等）
│
├── public/                     # 静的ファイル
├── .env.example
├── .gitignore
├── next.config.js
├── package.json
├── tailwind.config.js
└── tsconfig.json
```

### 2.2 主要ファイル

#### `frontend/package.json`
```json
{
  "name": "spc-expense-frontend",
  "version": "1.0.0",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@tanstack/react-query": "^5.0.0",
    "axios": "^1.6.0",
    "react-hook-form": "^7.48.0",
    "zod": "^3.22.0",
    "zustand": "^4.4.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "typescript": "^5.2.0",
    "tailwindcss": "^3.3.0",
    "eslint": "^8.0.0"
  }
}
```

#### `frontend/next.config.js`
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  env: {
    NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL,
  },
  images: {
    domains: ['your-s3-bucket.s3.amazonaws.com'],
  },
}

module.exports = nextConfig
```

---

## 3. バックエンド構成（Express）

### 3.1 ディレクトリ構造

```
backend/
├── src/
│   ├── controllers/            # コントローラー
│   │   ├── auth.controller.ts
│   │   ├── expense-application.controller.ts
│   │   ├── receipt.controller.ts
│   │   └── admin.controller.ts
│   │
│   ├── models/                 # データモデル（Prisma使用）
│   │   └── index.ts
│   │
│   ├── routes/                 # ルーティング
│   │   ├── auth.routes.ts
│   │   ├── expense-application.routes.ts
│   │   ├── receipt.routes.ts
│   │   └── admin.routes.ts
│   │
│   ├── services/               # ビジネスロジック
│   │   ├── auth.service.ts
│   │   ├── ocr.service.ts
│   │   ├── payment.service.ts
│   │   └── spc-member-db.service.ts
│   │
│   ├── middleware/            # ミドルウェア
│   │   ├── auth.middleware.ts
│   │   ├── error.middleware.ts
│   │   └── validation.middleware.ts
│   │
│   ├── utils/                  # ユーティリティ
│   │   ├── logger.ts
│   │   ├── errors.ts
│   │   └── validators.ts
│   │
│   ├── config/                 # 設定
│   │   ├── database.ts
│   │   └── env.ts
│   │
│   └── app.ts                  # Expressアプリケーション
│   └── server.ts              # サーバー起動
│
├── prisma/
│   ├── schema.prisma
│   └── migrations/
│
├── tests/                      # テスト
│   ├── unit/
│   └── integration/
│
├── .env.example
├── .gitignore
├── Dockerfile
├── package.json
├── railway.json
└── tsconfig.json
```

### 3.2 主要ファイル

#### `backend/package.json`
```json
{
  "name": "spc-expense-backend",
  "version": "1.0.0",
  "scripts": {
    "dev": "ts-node-dev --respawn --transpile-only src/server.ts",
    "build": "tsc",
    "start": "node dist/server.js",
    "migrate": "prisma migrate deploy",
    "migrate:dev": "prisma migrate dev",
    "generate": "prisma generate",
    "test": "jest"
  },
  "dependencies": {
    "express": "^4.18.0",
    "@prisma/client": "^5.7.0",
    "jsonwebtoken": "^9.0.0",
    "bcryptjs": "^2.4.3",
    "cors": "^2.8.5",
    "dotenv": "^16.3.0",
    "multer": "^1.4.5",
    "@google-cloud/vision": "^3.3.0",
    "aws-sdk": "^2.1500.0",
    "zod": "^3.22.0"
  },
  "devDependencies": {
    "@types/express": "^4.17.0",
    "@types/node": "^20.0.0",
    "typescript": "^5.2.0",
    "ts-node-dev": "^2.0.0",
    "prisma": "^5.7.0",
    "jest": "^29.7.0"
  }
}
```

#### `backend/src/app.ts`
```typescript
import express from 'express';
import cors from 'cors';
import { errorHandler } from './middleware/error.middleware';
import authRoutes from './routes/auth.routes';
import expenseApplicationRoutes from './routes/expense-application.routes';
// ... 他のルート

const app = express();

// ミドルウェア
app.use(cors({
  origin: process.env.CORS_ORIGIN || 'http://localhost:3001',
  credentials: true
}));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// ルート
app.use('/api/v1/auth', authRoutes);
app.use('/api/v1/expense-applications', expenseApplicationRoutes);
// ... 他のルート

// エラーハンドリング
app.use(errorHandler);

export default app;
```

---

## 4. 環境変数設定

### 4.1 フロントエンド（.env.example）

```env
NEXT_PUBLIC_API_URL=http://localhost:3000/api/v1
NEXT_PUBLIC_APP_URL=http://localhost:3001
```

### 4.2 バックエンド（.env.example）

```env
# アプリケーション
NODE_ENV=development
PORT=3000
API_VERSION=v1

# データベース
DATABASE_URL=postgresql://user:password@localhost:5432/spc_expense

# JWT
JWT_SECRET=your-secret-key-here
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d

# CORS
CORS_ORIGIN=http://localhost:3001

# OCR (Google Cloud Vision API)
GOOGLE_CLOUD_PROJECT_ID=your-project-id
GOOGLE_APPLICATION_CREDENTIALS=./credentials.json

# ファイルストレージ (AWS S3)
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_REGION=ap-northeast-1
AWS_S3_BUCKET_NAME=spc-expense-receipts-dev

# SPC会員DB連携
SPC_MEMBER_DB_API_URL=https://spc-member-db.example.com/api
SPC_MEMBER_DB_API_KEY=your-api-key
```

---

## 5. デプロイ設定

### 5.1 Vercel（フロントエンド）

Vercelは自動検出するため、特別な設定は不要。必要に応じて`vercel.json`を作成。

### 5.2 Railway（バックエンド）

`railway.json`を作成（既に作成済み）。

---

## 6. 次のステップ

1. **リポジトリ作成**: GitHubでリポジトリを作成
2. **プロジェクト初期化**: 上記構成に従ってプロジェクトを作成
3. **環境変数設定**: `.env.example`をコピーして設定
4. **初回コミット**: プロジェクト構成をコミット
5. **デプロイ**: VercelとRailwayに接続
